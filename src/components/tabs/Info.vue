<template>
    <div>
        <h3>Server Info</h3>
        <mc-button v-show="!!this.$store.state.servers[this.$store.state.selectedServer] && hasPermission" :dark="true" :click="edit" class="button" :pressed="editing">
            <img src="pencil.png" alt="edit" align="right">
        </mc-button>
        <mc-button v-show="editing" :dark="true" :click="revert" class="button">
            <img src="revert.png" alt="revert" align="right">
        </mc-button>
        <table v-if="!!this.$store.state.servers[this.$store.state.selectedServer]" id="infotable">
            <tbody>
                <tr>
                    <td>Name:</td>
                    <td class="rightside"><span id="infotablename" :contenteditable="editing" @input="editName">{{ this.$store.state.servers[this.$store.state.selectedServer].name }}</span></td>
                </tr>
                <tr>
                    <td colspan="2" class="rightside exep">
                        <!-- <br> -->
                        Description:
                        <p style="margin-inline-start: 1em;" id="infotabledesc" class="description" :contenteditable="editing" @input="editDesc">{{ this.$store.state.servers[this.$store.state.selectedServer].description }}</p>
                    </td>
                </tr>
                <tr>
                    <td>Status:</td>
                    <!-- TODO -->
                    <td class="rightside"><span id="infotablestatus" :class="{ red: this.$store.state.servers[this.$store.state.selectedServer].status === 'Stopped', green: this.$store.state.servers[this.$store.state.selectedServer].status === 'Started', yellow: true}">{{ this.$store.state.servers[this.$store.state.selectedServer].status }}</span></td>
                    <!-- <td class="editbutton"><img src="pencil.png" alt="edit"></td> -->
                </tr>
                <tr>
                    <td>Players Online:</td>
                    <td class="rightside"><span id="infotableplayersonline">{{ this.$store.state.servers[this.$store.state.selectedServer].onlinePlayers }}</span>/<span id="infotablemaxplayers">{{ this.$store.state.servers[this.$store.state.selectedServer].maxPlayers }}</span></td>
                </tr>
                <tr>
                    <td>Port:</td>
                    <td class="rightside">
                        <span id="infotableport" v-show="!editing">{{ this.$store.state.servers[this.$store.state.selectedServer].port }}</span>
                        <input type="number" v-model="edited.port" v-show="editing">
                    </td>
                </tr>
                <tr>
                    <td>Version:</td>
                    <td class="rightside">
                        <span id="infotableversion" v-show="!editing">{{ this.$store.state.servers[this.$store.state.selectedServer].version }}</span>
                        <select v-if="!!this.$store.state.servers[this.$store.state.selectedServer]" v-model="edited.version" v-show="editing">
                            <option v-for="version of globalMCVersions" :key="version" :value="version">{{ version }}</option>
                        </select>
                    </td>
                </tr>
            </tbody>
        </table>
        <p v-show="!this.$store.state.servers[this.$store.state.selectedServer]">No server selected {{ LocalPermissions.CAN_EDIT_PROPERTIES }}</p>
    </div>
</template>
<script lang="ts">
import Vue from 'vue';
import mcButton from '../elements/mcButton.vue';
import { LocalPermissions } from '../../constants';

export default Vue.extend({
    data: () => {
        return {
            editing: false,
            edited: {}
        }
    },
    methods: {
        edit() {
            this.editing = !this.editing;
            if(this.editing) {
                this.edited = Object.assign({}, this.$store.state.servers[this.$store.state.selectedServer]);
                // TODO: socket server updated
            } else {
                for(let key in this.edited) {
                    this.$store.state.servers[this.$store.state.selectedServer][key] = this.edited[key];
                }
            }
        },
        revert() {
            this.editing = false;
            this.edited = {};
            document.getElementById('infotablename').innerText = this.$store.state.servers[this.$store.state.selectedServer].name;
            document.getElementById('infotabledesc').innerText = this.$store.state.servers[this.$store.state.selectedServer].description;
        },
        editName(evt) {
            let src = evt.target.innerText;
            this.edited.name = src;
        },
        editDesc(evt) {
            let src = evt.target.innerText;
            this.edited.description = src;
        }
    },
    components: {
        mcButton
    },
    computed: {
        hasPermission() {
            return this.$store.state.servers[this.$store.state.selectedServer].access & LocalPermissions.CAN_EDIT_PROPERTIES;
        }
    }
    // watch: {
    // }
})
</script>
<style scoped>
.rightside:not(.exep) {
    text-align: right;
    padding-left: 20px;
    width: 100%;
}
#infotable {
    width: 100%;
    border-collapse: collapse;
    padding: 5px;
    display: block;
}
img {
    padding-right: 2px;
    height: 1.7em;
}
h3 {
    display: inline-block;
    /* margin-inline-start: 5px; */
    font-weight: normal;
}
.button {
    float: right;
    margin: 4px;
}
/* mc-button {
    align-self: right;
} */
</style>